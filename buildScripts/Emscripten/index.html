<html>
<style>
    html,
    body {
        overflow: hidden;
        height: 100%;
        margin: 0;
    }
    body {
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: black;
    }
    #moduleStatusString {
        color: red;
        font-size: 30px;
    }
    #canvas {
        display: none;
        border: 1px solid white;
    }
</style>
<body>
    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
        <canvas id="canvas"></canvas>        
        <div id="moduleStatusString">Downloading...</div>
    </div>
    <script type="text/javascript">
        var canvas = document.getElementById("canvas");
        // make the canvas fullscreen
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        canvas.oncontextmenu = function (e) {
            e.preventDefault();
        };
        function resizeCanvas() {
            let scaleX = window.innerWidth / 1920;
            let scaleY = window.innerHeight / 1080;
            let scale = Math.min(scaleX, scaleY);
            canvas.style.transform = `scaleX(${scale}) scaleY(${scale})`;
        }
        window.addEventListener('resize', resizeCanvas);
        var statusElement = document.getElementById('moduleStatusString');
        var downloadingSymbolRightArrow = false;
        // show Emscripten environment where the canvas is
        var Module = {
            setStatus: function (text) {
                try {
                    // Cool preloader
                    var regexMatch = text.match("([0-9]*)\/([0-9]*)");
                    var progress = "";
                    if (regexMatch != null && regexMatch.length == 3) {
                        var downloaded = parseFloat(regexMatch[1]) / 1024.0 / 1024.0;
                        var total = parseFloat(regexMatch[2]) / 1024.0 / 1024.0;
                        if (total == 0) {
                            total = 1;
                        }
                        let percent = (downloaded / total) * 100;
                        progress = Math.round(percent).toString() + "%";
                        var downloadingSymbol = downloadingSymbolRightArrow == true ? ">" : "<";
                        downloadingSymbolRightArrow = !downloadingSymbolRightArrow;
                        var outputString = downloadingSymbol + " " + downloaded.toFixed(2).toString() + " MB / " + total.toFixed(2).toString() + " MB " + progress;
                        statusElement.innerHTML = outputString;
                        if (percent > 99 && statusElement.style.display != "none") {
                            statusElement.style.display = "none";
                            let canvas = document.getElementById("canvas");
                            canvas.style.display = "block";
                            resizeCanvas();
                        }
                    }
                    else {
                        statusElement.innerHTML = "";
                    }
                }
                catch (error) {
                    console.log(error);
                    statusElement.innerHTML = "";
                }
            }
        };
        Module.canvas = canvas;
    </script>
    <script>
        function checkFocus() {
            window.focus();
        }
        window.setInterval(checkFocus, 1000); 
    </script>
    <script type="text/javascript" src="SurrealEngine.js"></script>
</body>
</html>
